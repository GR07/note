# 迭代器模式

用于顺序访问有序集合（数组、NodeList），不需要知道集合的长度和内部结构，高内聚低耦合。


# 简易迭代器

```js
// for 循环
const arr = [10, 20, 30]
const length = arr.length
for (let i = 0; i < length; i++) {
    console.log(arr[i])
}
```

```js
// forEach
const pList = document.querySelectorAll('p')
pList.forEach(p => console.log(p))
```


# 演示

```ts
class DataIterator {
    private data: number[]
    private index = 0

    constructor(container: DataContainer) {
        this.data = container.data
    }

    next(): number | null {
        if (this.hasNext()) {
            return this.data[this.index++]
        }
        return null
    }

    hasNext() {
        if (this.index >= this.data.length) return false
        return true
    }
}

class DataContainer {
    data: number[] = [10, 20, 30, 40]
    getIterator() {
        return new DataIterator(this)
    }
}

const container = new DataContainer()
const iterator = container.getIterator()
while(iterator.hasNext()) {
    const num = iterator.next()
    console.log(num)
}
```

## 是否符合设计原则？

- 使用者和目标数据分离，解耦，符合开放封闭原则

- 目标数据自行控制内部迭代逻辑

- 使用者不关心目标数据的内部结构


# JS 有序对象

JS 有序对象，都内置迭代器，是按照插入顺序排列的。

- 字符串
- 数组
- NodeList 等 DOM 集合
- Map
- Set
- arguments

对象 object 不是有序结构


## Symbol.iterator

每个有序对象，都内置了 `Symbol.iterator` 属性，属性值是一个函数。
执行该函数，返回 iterator 迭代器（对象），有 `next()` 方法，执行返回 `{ value, done }` 结构。

```js
// 拿数组举例，其他类型也一样

const arr = [10, 20, 30]
const iterator = arr[Symbol.iterator]()

iterator.next() // {value: 10, done: false}
iterator.next() // {value: 20, done: false}
iterator.next() // {value: 30, done: false}
iterator.next() // {value: undefined, done: true}
```


## 模拟内置迭代器

```ts
interface IteratorRes {
    value: number | undefined
    done: boolean
}

class CustomIterator {
    private length = 3
    private index = 0

    next(): IteratorRes {
        this.index++
        if (this.index <= this.length) {
            return { value: this.index, done: false }
        }
        return { value: undefined, done: true }
    }

    [Symbol.iterator]() {
        return this
    }
}

const iterator = new CustomIterator()
console.log( iterator.next() )
console.log( iterator.next() )
console.log( iterator.next() )
console.log( iterator.next() )
```