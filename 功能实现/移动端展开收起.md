# 工具函数

hyphenToCamel: 将连字符命名转为驼峰命名（如 padding-top → paddingTop）

getCssPropertyValue: 获取指定DOM元素的计算样式属性值


# 核心逻辑（mounted钩子）

组件挂载后的主要流程：

1. 获取样式计算值

    获取padding、line-height、height等样式属性

    计算指定行数应该占据的高度：paddingTop + paddingBottom + lineHeight * this.row

2. 判断是否需要折叠

    如果实际高度 > 计算高度，说明内容超出行数限制

    设置容器高度为指定行数的高度，并添加溢出隐藏

    添加展开/收起的点击事件

3. 展开/收起交互

    点击时切换isFold状态

    展开时：高度设为auto，显示全部内容

    收起时：恢复限制高度

# 样式特点

1. 单行省略：使用传统的white-space: nowrap; text-overflow: ellipsis;

2. 多行省略：通过JS计算高度实现

3. 按钮定位：使用绝对定位固定在右下角

4. 按钮背景色：自动继承父元素背景色，避免遮挡文本


# 优缺点分析

1. 优点：

    兼容性好，不依赖CSS的-webkit-line-clamp

    支持自定义操作按钮（通过slot）

    自动计算高度，配置简单

2. 缺点：

  需要在mounted中操作DOM，可能引起布局抖动（先隐藏再显示）

  依赖JS计算，可能出现计算误差

  不支持响应式变化（窗口大小改变时不会重新计算）

  这是一个比较实用的文本省略组件，特别适合需要精确控制显示行数的场景。


```js
<script>
  function hyphenToCamel (str) {
    return str.replace(/-([a-z])/g, function (match, char) {
      return char.toUpperCase()
    })
  }

  function getCssPropertyValue (selector, cssProperty, context = document) {
    let resMap = {}
    const dom = context ? context.querySelector(selector) : null
    if (!dom) return resMap
    const computedStyles = window.getComputedStyle(dom)
    if (cssProperty && cssProperty.length > 0) {
      cssProperty.forEach(prop => {
        resMap[hyphenToCamel(prop)] = parseInt(computedStyles.getPropertyValue(prop)) || 0
      })
    }
    return resMap
  }

  export default {
    props: {
      row: {
        type: Number,
        default: 1
      }
    },
    data () {
      return {
        isFold: true
      }
    },
    computed: {
      isEnableFold () {
        return this.row > 1
      }
    },
    render () {
      return (
        <div class={['hr-ellipsis-text', { 'single-ellipsis': !this.isEnableFold }]}>
          {this.isEnableFold && <div class="collapse-btn">
            {this.isFold ? <span>...&nbsp;</span> : null}
            {this.$slots.operate || <span class="collapse-btn__operate"></span>}
          </div>}
          {this.$slots.default}
        </div>
      )
    },
    mounted () {
      if (this.row < 2) return
      const cssProperties = ['padding-top', 'padding-bottom', 'line-height', 'height']
      const ellipsisStyle = getCssPropertyValue('.hr-ellipsis-text', cssProperties, this.$el.parentNode)
      this.$el.style.display = 'none'
      let collapseTextDom = this.$el.querySelector('.collapse-btn')
      const slotContent = collapseTextDom.lastChild.innerHTML.trim()
      const { paddingTop, paddingBottom, lineHeight, height } = ellipsisStyle
      const renderHeight = paddingTop + paddingBottom + lineHeight * this.row
      console.info(paddingTop, paddingBottom, lineHeight, height, renderHeight)
      if (height > renderHeight) {
        Object.assign(this.$el.style, {
          'position': 'relative',
          'height': renderHeight + 'px',
          'text-align': 'justify',
          'overflow': 'hidden'
        })
        collapseTextDom.lastChild.innerHTML = slotContent || '展开'
        Object.assign(collapseTextDom.style, {
          'position': 'absolute',
          'right': '0',
          'bottom': '0',
          'text-align': 'justify',
          'overflow': 'hidden',
          'background-color': window.getComputedStyle(this.$el.parentNode).backgroundColor
        })
        
        collapseTextDom.onclick = () => {
          if (this.isFold) {
            Object.assign(this.$el.style, {
              'height': 'auto',
              'padding-bottom': '20px'
            })
            collapseTextDom.lastChild.innerHTML = slotContent || '收起'
          } else {
            Object.assign(this.$el.style, {
              'height': renderHeight + 'px',
              'padding-bottom': 'unset'
            })
            collapseTextDom.lastChild.innerHTML = slotContent || '展开'
          }
          this.isFold = !this.isFold
        }
      } else {
        this.isFold = false
      }
      this.$el.style.display = 'block'
    }
  }
</script>

<style lang="less" scoped>
  .hr-ellipsis-text {
    &.single-ellipsis {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
  }

  .collapse-btn {
    display: inline-flex;

    &__operate {
      color: #7972fe;
    }
  }
</style>
```